# A json schema definition of the data used to generate all the envoy configurations for a mesh.
# See https://json-schema.org/


"$schema": "https://json-schema.org/draft-07/schema"

description: Consolidation of all the service data parts for an entire mesh.

type: object
required:
  - version
  - gateways
  - services
properties:
  version:
    description: Version of this document's schema.  The value must be the string value "v1".
    const: "v1"

  gateways:
    description: List of all the gateway configurations.
    type: array
    items:
      type: object
      required:
        - namespace
        - configuration
      properties:
        namespace:
          description: Namespace sub-mesh that the gateway governs entrance to.
          type: string
        configuration:
          $ref: '#/$defs/service-data-schema'
  services:
    description: List of all service ID specific configurations.
    type: array
    items:
      type: object
      required:
        - namespace
        - service
        - color
        - configuration
      properties:
        namespace:
          description: Namespace sub-mesh to which this service belongs.
          type: string
        service:
          description: Name of the service classification.
          type: string
        color:
          description: Service color, for alternate route path weights within the same service.  This allows for techniques like canary testing.
          type: string
        service-id:
          description: Optional opaque service ID the configuration was explicitly constructed for.
          type: string
        namespace-id:
          description: Optional opaque namespace ID the configuration was explicitly constructed for.
          type: string
        configuration:
          $ref: '#/$defs/service-data-schema'


$defs:
  service-data-schema:
    $ref: 'service-data-schema.yaml'
